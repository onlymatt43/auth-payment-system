
<!-- WIDGET COMPLET : Bouton + Modale de validation -->
<div id="om-auth-widget">
    
    <!-- 1. LE BOUTON VIDEO (D√©clencheur) -->
    <a href="#" id="om-auth-trigger" class="om-auth-btn" onclick="openAuthModal(event)">
        <video class="om-btn-video" 
               autoplay loop muted playsinline 
               poster="https://via.placeholder.com/200x60/333/fff?text=Loading"
               src="https://www.w3schools.com/html/mov_bbb.mp4">
        </video>
        <span class="om-btn-text">
            üîí D√âBLOQUER
        </span>
    </a>

    <!-- 2. LA MODALE (Cach√©e par d√©faut) -->
    <div id="om-auth-modal" class="om-modal" style="display: none;">
        <div class="om-modal-content">
            <span class="om-close" onclick="closeAuthModal()">&times;</span>
            
            <h2>Acc√®s Exclusif</h2>
            
            <!-- Option A: Acheter -->
            <div class="om-step">
                <p>Pas encore de code ?</p>
                <a href="https://payhip.com/b/VOTRE_LIEN" target="_blank" class="om-buy-link">
                    Obtenir un acc√®s ‚Üí
                </a>
            </div>

            <hr class="om-divider">

            <!-- Option B: Valider -->
            <div class="om-step">
                <p>D√©j√† un code ?</p>
                <form id="om-auth-form" onsubmit="handleAuthSubmit(event)">
                    <input type="email" id="om-email" placeholder="Votre Email" required class="om-input">
                    <input type="text" id="om-code" placeholder="Code Licence (ex: TIME_1H...)" required class="om-input">
                    
                    <button type="submit" class="om-submit-btn">
                        Valider l'acc√®s
                    </button>
                    <p id="om-message" class="om-message"></p>
                </form>
            </div>
        </div>
    </div>

</div>

<!-- 3. STYLES -->
<style>
    /* ... Styles pr√©c√©dents du bouton ... */
    .om-auth-btn {
        position: relative;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 200px;  /* Ajustable */
        height: 60px;  /* Ajustable */
        border-radius: 30px;
        overflow: hidden;
        text-decoration: none;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        transition: transform 0.2s, box-shadow 0.2s;
        background: #000;
        cursor: pointer;
    }

    .om-auth-btn:hover {
        transform: scale(1.05);
        box-shadow: 0 8px 25px rgba(0,0,0,0.5);
    }

    .om-btn-video {
        position: absolute;
        top: 0; left: 0; width: 100%; height: 100%;
        object-fit: cover;
        z-index: 1;
        opacity: 0.8;
    }

    .om-btn-text {
        position: relative;
        z-index: 2;
        color: white;
        font-family: sans-serif;
        font-weight: bold;
        font-size: 16px;
        letter-spacing: 1px;
        text-shadow: 0 2px 4px rgba(0,0,0,0.8);
        display: flex;
        align-items: center;
        gap: 8px;
    }

    /* Styles de la Modale */
    .om-modal {
        position: fixed;
        z-index: 9999;
        left: 0; top: 0;
        width: 100%; height: 100%;
        background-color: rgba(0,0,0,0.8); /* Fond sombre */
        display: flex;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(5px);
    }

    .om-modal-content {
        background: #1a1a1a;
        color: #fff;
        padding: 30px;
        border-radius: 15px;
        width: 90%;
        max-width: 400px;
        position: relative;
        text-align: center;
        font-family: sans-serif;
        border: 1px solid #333;
        box-shadow: 0 0 20px rgba(0,0,0,0.5);
    }

    .om-close {
        position: absolute;
        top: 10px; right: 15px;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        color: #aaa;
    }
    .om-close:hover { color: #fff; }

    .om-divider { margin: 20px 0; border-color: #333; }

    .om-input {
        width: 100%;
        padding: 12px;
        margin: 8px 0;
        box-sizing: border-box;
        border-radius: 8px;
        border: 1px solid #444;
        background: #2a2a2a;
        color: white;
        font-size: 14px;
    }
    .om-input:focus { border-color: #667eea; outline: none; }

    .om-submit-btn {
        width: 100%;
        padding: 12px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        border-radius: 8px;
        color: white;
        font-weight: bold;
        cursor: pointer;
        margin-top: 10px;
        transition: opacity 0.2s;
    }
    .om-submit-btn:hover { opacity: 0.9; }

    .om-buy-link {
        color: #667eea;
        text-transform: uppercase;
        font-size: 13px;
        letter-spacing: 1px;
        text-decoration: none;
        font-weight: bold;
    }
    .om-buy-link:hover { text-decoration: underline; }

    .om-message { font-size: 13px; margin-top: 10px; min-height: 20px; }
    .om-error { color: #ff6b6b; }
    .om-success { color: #51cf66; }
</style>

<!-- 4. LOGIQUE JS -->
<script>
    const API_URL = 'https://auth-payment-system.onrender.com/api/validate'; // URL de votre backend

    function openAuthModal(e) {
        if(e) e.preventDefault();
        document.getElementById('om-auth-modal').style.display = 'flex';
    }

    function closeAuthModal() {
        document.getElementById('om-auth-modal').style.display = 'none';
    }

    async function handleAuthSubmit(e) {
        e.preventDefault();
        
        const btn = e.target.querySelector('button');
        const msg = document.getElementById('om-message');
        const email = document.getElementById('om-email').value;
        const code = document.getElementById('om-code').value;

        // UI Loading
        btn.disabled = true;
        btn.textContent = 'V√©rification...';
        msg.textContent = '';
        msg.className = 'om-message';

        try {
            // Appel API (Standard super-videotheque-api / auth-payment-system)
            const response = await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ code: code, email: email }) // Payload attendu
            });

            const data = await response.json();

            if (response.ok && data.valid) { // Adapter selon la r√©ponse API r√©elle
                msg.textContent = 'Succ√®s ! Acc√®s d√©bloqu√©.';
                msg.classList.add('om-success');
                
                // Sauvegarder en local
                localStorage.setItem('accessGranted', 'true');
                localStorage.setItem('userEmail', email);
                localStorage.setItem('payhipCode', code);

                // Reload ou Callback
                setTimeout(() => {
                    closeAuthModal();
                    window.location.reload(); // Recharger pour appliquer les changements
                }, 1500);
            } else {
                throw new Error(data.message || 'Code invalide ou expir√©.');
            }

        } catch (error) {
            console.error(error);
            msg.textContent = error.message;
            msg.classList.add('om-error');
        } finally {
            btn.disabled = false;
            btn.textContent = "Valider l'acc√®s";
        }
    }

    // Fermer si on clique en dehors
    window.onclick = function(event) {
        const modal = document.getElementById('om-auth-modal');
        if (event.target == modal) {
            closeAuthModal();
        }
    }
</script>
